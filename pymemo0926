import asyncio
from bleak import BleakScanner

def parse_h5110(manufacturer_data: dict):
    """
    Govee H5110 の manufacturer_data をパースして温度・湿度を返す
    """
    for _, data in manufacturer_data.items():
        if len(data) >= 6:
            # データの 2〜5 バイト目に温湿度が入っている（仕様 reverse-engineering 情報より）
            temp_raw = int.from_bytes(data[2:4], byteorder="little", signed=True)
            hum_raw = int.from_bytes(data[4:6], byteorder="little")

            temperature = temp_raw / 100
            humidity = hum_raw / 100
            return temperature, humidity
    return None, None

async def main():
    def detection_callback(device, advertisement_data):
        if advertisement_data.manufacturer_data:
            temp, hum = parse_h5110(advertisement_data.manufacturer_data)
            if temp is not None:
                print(f"{device.address} | Temp: {temp:.2f} °C | Hum: {hum:.2f} %")

    scanner = BleakScanner(detection_callback=detection_callback)
    await scanner.start()
    await asyncio.sleep(10.0)  # 10秒間スキャン
    await scanner.stop()

asyncio.run(main())


Device: F2:B2:03:86:69:61
manufacturer_data: {1: b'\x01\x01\x040 d', 76: b'\x02\x15INTELLI_ROCKS_HWPu\xf2\xff\x0c'}




import asyncio
from bleak import BleakScanner

async def main():
    def detection_callback(device, advertisement_data):
        if advertisement_data.manufacturer_data:
            print(f"Device: {device.address}")
            print(f"manufacturer_data: {advertisement_data.manufacturer_data}")

    scanner = BleakScanner(detection_callback=detection_callback)
    await scanner.start()
    await asyncio.sleep(10.0)  # 10秒間スキャン
    await scanner.stop()

asyncio.run(main())

